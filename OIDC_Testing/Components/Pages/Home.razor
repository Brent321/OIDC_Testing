@page "/"
@inject IJSRuntime JS

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

<AuthorizeView>
    <Authorized>
        <p>Welcome, @context.User.Identity?.Name.</p>
        <p>
            <a class="btn btn-secondary me-2" href="/authentication/logout">Log out</a>
            <a class="btn btn-primary me-2" href="/api/roles/user">Call app-user endpoint</a>
            <a class="btn btn-warning" href="/api/roles/admin">Call app-admin endpoint</a>
        </p>
    </Authorized>
    <NotAuthorized>
        <p>Please sign in to access protected features.</p>
        <div class="d-flex gap-2">
            <a class="btn btn-primary" href="/authentication/login">Sign in (Default)</a>
            <a class="btn btn-outline-primary" href="/authentication/login-oidc">Sign in with OIDC</a>
            <a class="btn btn-outline-secondary" href="/authentication/login-saml">Sign in with SAML</a>
        </div>
    </NotAuthorized>
</AuthorizeView>

<hr class="my-4" />

<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Development Tools</h4>
    <p>Use this button to clear all authentication cookies when switching between OIDC and SAML modes.</p>
    <button class="btn btn-danger btn-sm" @onclick="ClearCookies">
        <i class="bi bi-trash"></i> Clear Authentication Cookies
    </button>
</div>

@code {
    private async Task ClearCookies()
    {
        try
        {
            var response = await new HttpClient().GetAsync("/authentication/clear-cookies");
            if (response.IsSuccessStatusCode)
            {
                await JS.InvokeVoidAsync("alert", "Authentication cookies cleared successfully. The page will now reload.");
                await JS.InvokeVoidAsync("location.reload");
            }
        }
        catch (Exception ex)
        {
            await JS.InvokeVoidAsync("alert", $"Error clearing cookies: {ex.Message}");
        }
    }
}
